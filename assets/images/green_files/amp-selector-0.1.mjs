;
(self.AMP=self.AMP||[]).push({m:1,v:"2301261900000",n:"amp-selector",ev:"0.1",l:!0,f:function(t,s){(()=>{var s;function e(){return s||(s=Promise.resolve(void 0))}function i(t){return t?Array.prototype.slice.call(t):[]}function n(t,s){if(t.length!==s.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==s[e])return!1;return!0}var{hasOwnProperty:r,toString:o}=Object.prototype,h="Enter",c="ArrowLeft",l="ArrowUp",a="ArrowRight",u="ArrowDown",d="Home",p="End";function _(t){return"rtl"==(t.body.getAttribute("dir")||t.documentElement.getAttribute("dir")||"ltr")}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var f=self.__AMP_LOG;function A(t){return function(t,s){throw new Error("failed to call initLogConstructor")}()}function m(t,s,e,i,n,r,o,h,c,l,a){return t}function b(t,s,e,i,n,r,o,h,c,l,a){return(f.user||(f.user=A()),void f.user.win?f.userForEmbed||(f.userForEmbed=A()):f.user).assert(t,s,e,i,n,r,o,h,c,l,a)}function P(t){return t.nodeType?(e=t,s=(e.ownerDocument||e).defaultView,function(t,s){return E(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),"ampdoc")}(s)).getAmpDoc(t):t;var s,e}function E(t,s){m(g(t,s));const e=function(t){let s=t.__AMP_SERVICES;return s||(s=t.__AMP_SERVICES={}),s}(t)[s];return e.obj||(m(e.ctor),m(e.context),e.obj=new e.ctor(e.context),m(e.obj),e.context=null,e.resolve&&e.resolve(e.obj)),e.obj}function g(t,s){const e=t.__AMP_SERVICES&&t.__AMP_SERVICES[s];return!(!e||!e.ctor)}var v="amp-selector",w="none",R="select",T=class extends t.BaseElement{static prerenderAllowed(){return!0}constructor(t){super(t),this.KU=!1,this.QU=[],this.jt=[],this.XU=[],this.Yc=null,this.YU=0,this.ZU=w}isLayoutSupported(){return!0}buildCallback(){this.Yc=function(t,s){const e=function(t){const s=P(t);return s.isSingleDoc()?s.win:s}(P(t));return g(e,s)?E(e,s):null}(this.element,"action"),this.KU=this.element.hasAttribute("multiple"),this.element.hasAttribute("role")||this.element.setAttribute("role","listbox"),this.KU&&this.element.setAttribute("aria-multiselectable","true"),this.element.hasAttribute("disabled")&&this.element.setAttribute("aria-disabled","true");let t=this.element.getAttribute("keyboard-select-mode");var s;t?(t=t.toLowerCase(),b("none"===(s=t)||"focus"===s||"select"===s,`Unknown keyboard-select-mode: ${t}`),b(!(this.KU&&t==R),"[keyboard-select-mode=select] not supported for multiple selection amp-selector")):t=w,this.ZU=t,this.registerAction("clear",this.EH.bind(this)),this.dl(),this.element.addEventListener("click",this.uL.bind(this)),this.element.addEventListener("keydown",this.wH.bind(this)),this.registerAction("selectUp",(t=>{const{args:s,trust:e}=t,i=s&&void 0!==s.delta?-s.delta:-1;this.RH(i,e)}),1),this.registerAction("selectDown",(t=>{const{args:s,trust:e}=t,i=s&&void 0!==s.delta?s.delta:1;this.RH(i,e)}),1),this.registerAction("toggle",(t=>{const{args:s,trust:e}=t;return b(s.index>=0,"'index' must be greater than 0"),b(s.index<this.jt.length,"'index' must be less than the length of options in the <amp-selector>"),s&&void 0!==s.index?this.I$(s.index,s.value,e):Promise.reject("'index' must be specified")}),1),this.Yc.addToAllowlist(v,["clear","selectDown","selectUp","toggle"],["email"]),this.element.addEventListener("amp:dom-update",this.TH.bind(this))}mutatedAttributesCallback(t){const s=t.selected;void 0!==s&&this.IH(s);const e=t.disabled;void 0!==e&&(e?this.element.setAttribute("aria-disabled","true"):this.element.removeAttribute("aria-disabled"))}IH(t){let s=Array.isArray(t)?t:[t];if(null===t||0==s.length)return void this.EH();if(this.KU||(s=s.slice(0,1)),n(this.MH().sort(),s.sort()))return;const e=s.reduce(((t,s)=>(t[s]=!0,t)),Object.create(null));for(let t=0;t<this.jt.length;t++){const s=this.jt[t];e[s.getAttribute("option")]?this.kH(s):this.VH(s)}this.OH(),this.xH()}OH(t){if(this.ZU==w)return;this.jt.forEach((t=>{t.tabIndex=-1}));let s=t;s||(s=this.KU?this.jt[0]:this.QU[0]||this.jt[0]),s&&(this.YU=this.jt.indexOf(s),s.tabIndex=0)}TH(t){const s=i(this.element.querySelectorAll("[option]"));n(this.jt,s)||this.dl(s)}dl(t){this.QU.length=0;const s=t||i(this.element.querySelectorAll("[option]"));s.forEach((t=>{t.hasAttribute("role")||t.setAttribute("role","option"),t.hasAttribute("disabled")&&t.setAttribute("aria-disabled","true"),t.hasAttribute("selected")?this.kH(t):this.VH(t),t.tabIndex=0})),this.jt=s,this.OH(),this.xH()}xH(){const t=[],s=this.element.getAttribute("name");if(!s||this.element.hasAttribute("disabled"))return t;const e=this.element.getAttribute("form");this.XU.forEach((t=>{this.element.removeChild(t)})),this.XU=[];const i=this.win.document,n=i.createDocumentFragment();return this.QU.forEach((r=>{if(!r.hasAttribute("disabled")){const o=i.createElement("input"),h=r.getAttribute("option");o.setAttribute("type","hidden"),o.setAttribute("name",s),o.setAttribute("value",h),e&&o.setAttribute("form",e),this.XU.push(o),n.appendChild(o),t.push(h)}})),this.element.appendChild(n),t}SH(t){t.hasAttribute("disabled")||this.mutateElement((()=>{t.hasAttribute("selected")?this.KU&&(this.VH(t),this.xH()):(this.kH(t),this.xH()),this.OH(t),this.DH(t,3)}))}MH(){return this.QU.map((t=>t.getAttribute("option")))}uL(t){if(this.element.hasAttribute("disabled"))return;let s=t.target;s&&(s.hasAttribute("option")||(s=s.closest("[option]")),s&&this.SH(s))}I$(t,s,i){const n=this.jt[t],r=n.hasAttribute("selected"),o=void 0!==s?s:!r,h=this.jt.indexOf(this.QU[0]);return o===r?e():this.mutateElement((()=>{if(h!==t){this.kH(n);const t=this.jt[h];t&&this.VH(t)}else this.VH(n);this.DH(n,i)}))}DH(t,s){const e=function(t,s,e,i){const n={detail:e};return Object.assign(n,void 0),new t.CustomEvent("amp-selector.select",n)}(this.win,0,{"targetOption":t.getAttribute("option"),"selectedOptions":this.MH()});this.Yc.trigger(this.element,"select",e,s)}RH(t,s){const e=this.jt.indexOf(this.QU[0]),i=(n=-1===e&&t<0?t:e+t,r=this.jt.length,n>0&&r>0?n%r:(n%r+r)%r);var n,r;const o=this.jt[i];this.kH(o);const h=this.jt[e];h&&this.VH(h),this.xH(),this.DH(o,s)}wH(t){if(this.element.hasAttribute("disabled"))return e();const{key:s}=t;switch(s){case c:case l:case a:case u:case d:case p:return this.ZU!=w?this.UH(t):e();case h:case" ":return this.HH(t),e()}return e()}UH(t){const s=this.win.document;let i=0;switch(t.key){case c:i=_(s)?1:-1;break;case l:case p:i=-1;break;case a:i=_(s)?-1:1;break;case u:case d:i=1;break;default:return e()}return t.preventDefault(),this.jt[this.YU].tabIndex=-1,this.FH().then((s=>{const e=this.YU;switch(t.key){case d:this.YU=this.jt.length-1;break;case p:this.YU=0}do{this.YU=(this.YU+i)%this.jt.length,this.YU<0&&(this.YU=this.YU+this.jt.length)}while(I(this.jt[this.YU],s[this.YU])&&this.YU!=e);const n=this.jt[this.YU];n.tabIndex=0,function(t){try{t.focus()}catch(t){}}(n);const r=this.jt[this.YU];this.ZU==R&&this.SH(r)}))}HH(t){const{key:s}=t;if((" "==s||s==h)&&this.jt.includes(t.target)){t.preventDefault();const s=t.target;this.SH(s)}}VH(t){t.removeAttribute("selected"),t.setAttribute("aria-selected","false");const s=this.QU.indexOf(t);-1!==s&&this.QU.splice(s,1)}EH(){for(;this.QU.length>0;){const t=this.QU.pop();this.VH(t)}this.xH()}kH(t){this.QU.includes(t)||(this.KU||this.EH(),t.setAttribute("selected",""),t.setAttribute("aria-selected","true"),this.QU.push(t))}getElementsForTesting(){return this.jt}getSelectedElementsForTesting(){return this.QU}FH(){return this.measureElement((()=>this.jt.map((t=>t.getBoundingClientRect()))))}};function I(t,s){const{height:e,width:i}=s;return t.hidden||0==i||0==e}t.registerElement(v,T,"amp-selector [option]{cursor:pointer}amp-selector [option][selected]{cursor:auto;outline:1px solid rgba(0,0,0,0.7)}amp-selector[multiple] [option][selected]{cursor:pointer;outline:1px solid rgba(0,0,0,0.7)}amp-selector [disabled][option],amp-selector[disabled] [option],amp-selector[disabled] [selected],amp-selector [selected][disabled]{cursor:auto;outline:none}\n/*# sourceURL=/extensions/amp-selector/0.1/amp-selector.css*/")})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-selector-0.1.mjs.map